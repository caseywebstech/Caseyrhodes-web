<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CASEYRHODES MINI PAIR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: #000;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        /* Flower Container */
        .flower-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .falling-flower {
            position: absolute;
            font-size: 25px;
            opacity: 0;
            pointer-events: auto;
            cursor: grab;
            user-select: none;
            z-index: 2;
        }

        .falling-flower.grabbed {
            cursor: grabbing;
            z-index: 9999;
            filter: drop-shadow(0 5px 15px rgba(255, 0, 85, 0.5));
        }

        @keyframes fall {
            0% {
                opacity: 1;
                transform: translateY(-100px) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(360deg);
            }
        }

        /* Music Player */
        .music-player {
            position: fixed;
            left: 20px;
            bottom: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .music-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff0055, #ff3377);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 25px rgba(255, 0, 85, 0.4);
            transition: all 0.3s;
            border: none;
            font-size: 20px;
            color: white;
            animation: pulse-music 2s ease-in-out infinite;
        }

        .music-btn:hover {
            transform: scale(1.1);
        }

        .music-btn.playing {
            animation: spin 3s linear infinite, pulse-music 2s ease-in-out infinite;
        }

        @keyframes pulse-music {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 5px 25px rgba(255, 0, 85, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 8px 35px rgba(255, 0, 85, 0.6);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .flower-selector {
            width: 46px;
            height: 46px;
            background: linear-gradient(135deg, #ff0055, #ff3377);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 0, 85, 0.4);
            transition: all 0.3s;
            border: none;
            font-size: 18px;
            color: white;
        }

        .flower-selector:hover {
            transform: scale(1.1);
        }

        .flower-menu {
            position: absolute;
            bottom: 55px;
            left: 0;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 0, 85, 0.3);
            border-radius: 12px;
            padding: 8px;
            display: none;
            flex-direction: column;
            gap: 6px;
            z-index: 10000;
        }

        .flower-menu.active {
            display: flex;
        }

        .flower-option {
            background: rgba(255, 0, 85, 0.1);
            border: 1px solid rgba(255, 0, 85, 0.2);
            border-radius: 8px;
            padding: 6px 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            text-align: center;
            color: white;
        }

        .flower-option:hover {
            background: rgba(255, 0, 85, 0.3);
            transform: scale(1.1);
        }

        /* Neural Network Background */
        .neural-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: radial-gradient(ellipse at top, #1a0a0a 0%, #000 100%);
        }

        #neuralCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.4;
        }

        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 0, 85, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 0, 85, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: 2;
            animation: gridScroll 20s linear infinite;
        }

        @keyframes gridScroll {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Main Container */
        .main-container {
            position: relative;
            z-index: 3;
            width: 100%;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 20px 0 30px;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #ff0055;
            box-shadow: 0 0 30px rgba(255, 0, 85, 0.5);
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .title {
            font-size: 24px;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            color: #fff;
            margin-bottom: 8px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            letter-spacing: 0.5px;
        }

        /* Card */
        .card {
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 0, 85, 0.3);
            border-radius: 16px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 50px rgba(255, 0, 85, 0.2);
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Form Elements */
        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-label i {
            color: #ff0055;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(30, 30, 30, 0.8);
            font-size: 14px;
            font-family: 'Rajdhani', sans-serif;
            color: white;
            outline: none;
            transition: all 0.3s;
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        input:focus {
            border-color: #ff0055;
            background: rgba(40, 40, 40, 0.9);
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.2);
        }

        /* Buttons */
        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 25px;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
            font-family: 'Rajdhani', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff0055, #ff3377);
            color: #fff;
            box-shadow: 0 4px 20px rgba(255, 0, 85, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 0, 85, 0.5);
        }

        .btn-secondary {
            background: transparent;
            color: #ff0055;
            border: 2px solid #ff0055;
        }

        .btn-secondary:hover {
            background: rgba(255, 0, 85, 0.1);
            transform: translateY(-2px);
        }

        /* Result Section */
        .result-section {
            margin-top: 20px;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            animation: resultSlide 0.5s ease;
            display: none;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 0, 85, 0.2);
        }

        .result-section.show {
            display: block;
        }

        @keyframes resultSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .mini-loader {
            width: 50px;
            height: 50px;
            margin: 0 auto 20px;
            border: 4px solid rgba(255, 0, 85, 0.2);
            border-top: 4px solid #ff0055;
            border-radius: 50%;
            animation: spin-loader 1s linear infinite;
        }

        @keyframes spin-loader {
            to { transform: rotate(360deg); }
        }

        .code-display {
            font-size: 32px;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            letter-spacing: 8px;
            margin: 20px 0;
            cursor: pointer;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            border: 2px dashed rgba(255, 0, 85, 0.4);
            transition: all 0.3s;
            color: #ff3377;
        }

        .code-display:hover {
            border-color: #ff0055;
            transform: scale(1.02);
        }

        .copy-btn {
            background: linear-gradient(135deg, #ff0055, #ff3377);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 0, 85, 0.4);
        }

        /* Instructions */
        .instructions {
            margin-top: 25px;
            padding: 20px;
            background: rgba(255, 0, 85, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 0, 85, 0.2);
        }

        .instructions h3 {
            font-size: 16px;
            font-weight: 700;
            color: #ff0055;
            margin-bottom: 12px;
            font-family: 'Orbitron', monospace;
        }

        .instructions ol {
            list-style: none;
            padding: 0;
        }

        .instructions li {
            padding: 8px 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions li i {
            color: #ff0055;
            font-size: 14px;
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
            padding: 20px;
            background: rgba(20, 20, 20, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(255, 0, 85, 0.2);
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            color: #ff0055;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 0.8px;
            text-transform: uppercase;
        }

        /* Contact Button */
        .contact-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 0, 85, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 0, 85, 0.3);
            border-radius: 10px;
            padding: 10px 20px;
            color: #ff3377;
            text-decoration: none;
            font-size: 13px;
            font-weight: 700;
            z-index: 1000;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .contact-btn:hover {
            background: rgba(255, 0, 85, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 0, 85, 0.3);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff0055, #ff3377);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 700;
            z-index: 10000;
            box-shadow: 0 10px 30px rgba(255, 0, 85, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ff0055, #ff3377);
            border-radius: 10px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-container {
                padding: 15px;
            }

            .card {
                padding: 20px;
            }

            .title {
                font-size: 20px;
            }

            .logo-icon {
                width: 70px;
                height: 70px;
            }

            .music-player {
                left: 15px;
                bottom: 15px;
            }

            .contact-btn {
                top: 15px;
                left: 15px;
                padding: 8px 16px;
                font-size: 12px;
            }

            .stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .btn-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<!-- Neural Network Background -->
<div class="neural-bg"></div>
<canvas id="neuralCanvas"></canvas>
<div class="grid-overlay"></div>

<!-- Flower Container -->
<div class="flower-container" id="flowerContainer"></div>

<!-- Music Player -->
<div class="music-player">
    <button class="music-btn" id="musicBtn">üéµ</button>
    <div style="position: relative;">
        <button class="flower-selector" id="flowerSelector">üå∏</button>
        <div class="flower-menu" id="flowerMenu">
            <div class="flower-option" data-flower="üå∏">üå∏</div>
            <div class="flower-option" data-flower="üå∫">üå∫</div>
            <div class="flower-option" data-flower="üåº">üåº</div>
            <div class="flower-option" data-flower="üåª">üåª</div>
            <div class="flower-option" data-flower="üåπ">üåπ</div>
            <div class="flower-option" data-flower="üíê">üíê</div>
            <div class="flower-option" data-flower="üå∑">üå∑</div>
            <div class="flower-option" data-flower="üèµÔ∏è">üèµÔ∏è</div>
        </div>
    </div>
</div>

<!-- Audio Element -->
<audio id="bgMusic" loop></audio>

<!-- Contact Button -->
<a href="https://wa.me/+254704472907" class="contact-btn" target="_blank">
    <i class="fab fa-whatsapp"></i>
    Contact Owner
</a>

<!-- Main Container -->
<div class="main-container">
    <!-- Header -->
    <div class="header">
        <img src="https://i.ibb.co/DDd7WkwL/caseyweb.jpg" alt="CASEYRHODES" class="logo-icon">
        <div class="title">CASEYRHODES MINI PAIR</div>
        <div class="subtitle">Connect Your WhatsApp Instantly</div>
    </div>

    <!-- Card -->
    <div class="card">
        <!-- Form Section -->
        <div id="form-section">
            <div class="input-group">
                <label class="input-label">
                    <i class="fas fa-phone"></i> WHATSAPP NUMBER
                </label>
                <input type="tel" id="phone" placeholder="+254704472907" required>
            </div>

            <div class="btn-group">
                <button id="generate-btn" class="btn btn-primary">
                    <i class="fas fa-bolt"></i> GENERATE CODE
                </button>
                <button id="reset-btn" class="btn btn-secondary" style="display: none;">
                    <i class="fas fa-redo"></i> RESET
                </button>
            </div>
        </div>

        <!-- Loading Section -->
        <div id="loading-section" class="result-section" style="display: none;">
            <div class="mini-loader"></div>
            <p style="color: #ff3377; font-weight: 700; margin-top: 15px;">Generating Your Code...</p>
            <p style="color: rgba(255,255,255,0.5); font-size: 12px;">Please wait a moment</p>
        </div>

        <!-- Code Section -->
        <div id="code-section" class="result-section" style="display: none;">
            <div style="font-size: 40px; margin-bottom: 15px;">üîê</div>
            <h3 style="color: #ff3377; font-size: 18px; font-weight: 700; margin-bottom: 5px;">Your Pairing Code</h3>
            <p style="color: rgba(255,255,255,0.6); font-size: 12px; margin-bottom: 20px;">Do not share with anyone</p>
            
            <div id="pairing-code" class="code-display"></div>
            
            <button id="copy-btn" class="copy-btn">
                <i class="far fa-copy"></i> COPY CODE
            </button>

            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> HOW TO USE:</h3>
                <ol>
                    <li><i class="fas fa-mobile-alt"></i> Open WhatsApp on your phone</li>
                    <li><i class="fas fa-cog"></i> Go to Settings ‚Üí Linked Devices</li>
                    <li><i class="fas fa-link"></i> Tap 'Link a Device'</li>
                    <li><i class="fas fa-keyboard"></i> Select 'Link with phone number'</li>
                    <li><i class="fas fa-paste"></i> Enter the code above</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Stats -->
    <div class="stats">
        <div class="stat-item">
            <div class="stat-number">127K+</div>
            <div class="stat-label">USERS</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">99.9%</div>
            <div class="stat-label">UPTIME</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">24/7</div>
            <div class="stat-label">SUPPORT</div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.0.0-alpha.1/axios.min.js"></script>
<script>
    // ============ NEURAL NETWORK BACKGROUND ============
    const neuralCanvas = document.getElementById('neuralCanvas');
    const neuralCtx = neuralCanvas.getContext('2d');
    neuralCanvas.width = window.innerWidth;
    neuralCanvas.height = window.innerHeight;

    const nodes = [];
    const numNodes = 60;

    class Node {
        constructor() {
            this.x = Math.random() * neuralCanvas.width;
            this.y = Math.random() * neuralCanvas.height;
            this.vx = (Math.random() - 0.5) * 0.3;
            this.vy = (Math.random() - 0.5) * 0.3;
        }

        update() {
            this.x += this.vx;
            this.y += this.vy;
            if (this.x < 0 || this.x > neuralCanvas.width) this.vx *= -1;
            if (this.y < 0 || this.y > neuralCanvas.height) this.vy *= -1;
        }

        draw() {
            neuralCtx.beginPath();
            neuralCtx.arc(this.x, this.y, 1.5, 0, Math.PI * 2);
            neuralCtx.fillStyle = 'rgba(255, 0, 85, 0.7)';
            neuralCtx.fill();
        }
    }

    for (let i = 0; i < numNodes; i++) {
        nodes.push(new Node());
    }

    function drawConnections() {
        for (let i = 0; i < nodes.length; i++) {
            for (let j = i + 1; j < nodes.length; j++) {
                const dx = nodes[i].x - nodes[j].x;
                const dy = nodes[i].y - nodes[j].y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < 120) {
                    neuralCtx.beginPath();
                    neuralCtx.moveTo(nodes[i].x, nodes[i].y);
                    neuralCtx.lineTo(nodes[j].x, nodes[j].y);
                    neuralCtx.strokeStyle = `rgba(255, 0, 85, ${0.15 * (1 - dist / 120)})`;
                    neuralCtx.lineWidth = 0.8;
                    neuralCtx.stroke();
                }
            }
        }
    }

    function animateNeural() {
        neuralCtx.clearRect(0, 0, neuralCanvas.width, neuralCanvas.height);
        drawConnections();
        nodes.forEach(node => {
            node.update();
            node.draw();
        });
        requestAnimationFrame(animateNeural);
    }
    animateNeural();

    window.addEventListener('resize', () => {
        neuralCanvas.width = window.innerWidth;
        neuralCanvas.height = window.innerHeight;
    });

    // ============ FLOWER ANIMATION LOGIC ============
    let selectedFlower = 'üå∏';
    const flowerSelector = document.getElementById('flowerSelector');
    const flowerMenu = document.getElementById('flowerMenu');
    const flowerOptions = document.querySelectorAll('.flower-option');
    const flowerContainer = document.getElementById('flowerContainer');

    flowerSelector.addEventListener('click', function(e) {
        e.stopPropagation();
        flowerMenu.classList.toggle('active');
    });

    flowerOptions.forEach(option => {
        option.addEventListener('click', function(e) {
            e.stopPropagation();
            selectedFlower = this.dataset.flower;
            flowerSelector.textContent = selectedFlower;
            flowerMenu.classList.remove('active');
        });
    });

    document.addEventListener('click', function(e) {
        if (!flowerSelector.contains(e.target) && !flowerMenu.contains(e.target)) {
            flowerMenu.classList.remove('active');
        }
    });

    class Flower {
        constructor() {
            this.element = document.createElement('div');
            this.element.className = 'falling-flower';
            this.element.textContent = selectedFlower;
            
            this.startX = Math.random() * window.innerWidth;
            this.element.style.left = this.startX + 'px';
            this.element.style.fontSize = (Math.random() * 15 + 20) + 'px';
            this.element.style.color = `hsl(${Math.random() * 60 + 300}, 80%, 65%)`; // Pink/purple range
            
            this.duration = (Math.random() * 3 + 5) + 's';
            this.element.style.animation = `fall ${this.duration} linear forwards`;
            
            this.isDragging = false;
            this.setupDragEvents();
            
            flowerContainer.appendChild(this.element);
            
            setTimeout(() => {
                if (!this.isDragging && this.element.parentNode) {
                    this.element.remove();
                }
            }, parseFloat(this.duration) * 1000);
        }

        setupDragEvents() {
            const onStart = (e) => {
                e.preventDefault();
                this.isDragging = true;
                this.element.classList.add('grabbed');
                
                const computedStyle = window.getComputedStyle(this.element);
                const matrix = new DOMMatrix(computedStyle.transform);
                this.element.style.animation = 'none';
                this.element.style.top = matrix.m42 + 'px';
                this.element.style.left = matrix.m41 + 'px';
                this.element.style.transform = 'none';
                
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                
                this.dragOffsetX = clientX - parseFloat(this.element.style.left);
                this.dragOffsetY = clientY - parseFloat(this.element.style.top);
            };

            const onMove = (e) => {
                if (!this.isDragging) return;
                
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                
                this.element.style.left = (clientX - this.dragOffsetX) + 'px';
                this.element.style.top = (clientY - this.dragOffsetY) + 'px';
            };

            const onEnd = () => {
                if (!this.isDragging) return;
                this.isDragging = false;
                this.element.classList.remove('grabbed');
                
                const currentTop = parseFloat(this.element.style.top);
                const remainingDistance = window.innerHeight - currentTop;
                const remainingTime = (remainingDistance / window.innerHeight) * parseFloat(this.duration);
                
                this.element.style.animation = `fall ${remainingTime}s linear forwards`;
                
                setTimeout(() => {
                    if (this.element.parentNode) {
                        this.element.remove();
                    }
                }, remainingTime * 1000);
            };

            this.element.addEventListener('mousedown', onStart);
            this.element.addEventListener('touchstart', onStart, { passive: false });
            
            document.addEventListener('mousemove', onMove);
            document.addEventListener('touchmove', onMove, { passive: false });
            
            document.addEventListener('mouseup', onEnd);
            document.addEventListener('touchend', onEnd);
        }
    }

    // Start flower animation
    setInterval(() => {
        new Flower();
    }, 250);

    // ============ MUSIC PLAYER LOGIC ============
    const songs = [
        'https://files.catbox.moe/x31ls3.mp3',
        'https://files.catbox.moe/jydlzs.mp3',
        'https://files.catbox.moe/2cbngz.mp3'
    ];

    const bgMusic = document.getElementById('bgMusic');
    const musicBtn = document.getElementById('musicBtn');
    let isMusicPlaying = false;

    function playRandomSong() {
        const randomSong = songs[Math.floor(Math.random() * songs.length)];
        bgMusic.src = randomSong;
        bgMusic.volume = 0.2;
        bgMusic.play().then(() => {
            isMusicPlaying = true;
            musicBtn.classList.add('playing');
            musicBtn.textContent = '‚è∏Ô∏è';
        }).catch(err => {
            console.log('Autoplay prevented:', err);
        });
    }

    musicBtn.addEventListener('click', function() {
        if (isMusicPlaying) {
            bgMusic.pause();
            musicBtn.textContent = 'üéµ';
            musicBtn.classList.remove('playing');
            isMusicPlaying = false;
        } else {
            if (!bgMusic.src || bgMusic.ended) {
                playRandomSong();
            } else {
                bgMusic.play();
                musicBtn.textContent = '‚è∏Ô∏è';
                musicBtn.classList.add('playing');
                isMusicPlaying = true;
            }
        }
    });

    bgMusic.addEventListener('ended', () => {
        playRandomSong();
    });

    // Auto-start music on first interaction
    let firstInteraction = true;
    document.addEventListener('click', () => {
        if (firstInteraction && !isMusicPlaying) {
            playRandomSong();
            firstInteraction = false;
        }
    }, { once: true });

    document.addEventListener('touchstart', () => {
        if (firstInteraction && !isMusicPlaying) {
            playRandomSong();
            firstInteraction = false;
        }
    }, { once: true });

    // ============ PAIRING LOGIC ============
    const generateBtn = document.getElementById("generate-btn");
    const resetBtn = document.getElementById("reset-btn");
    const phoneInput = document.getElementById("phone");
    const formSection = document.getElementById("form-section");
    const loadingSection = document.getElementById("loading-section");
    const codeSection = document.getElementById("code-section");
    const pairingCode = document.getElementById("pairing-code");
    const copyBtn = document.getElementById("copy-btn");

    // Toast function
    function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = message;
        toast.style.background = type === 'error' 
            ? 'linear-gradient(135deg, #ff0000, #ff5555)' 
            : 'linear-gradient(135deg, #ff0055, #ff3377)';
        
        document.getElementById('toast-container').appendChild(toast);
        
        setTimeout(() => toast.classList.add('show'), 10);
        
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 500);
        }, 3000);
    }

    // Generate code
    generateBtn.addEventListener("click", async () => {
        const numberValue = phoneInput.value.trim();
        
        if (!numberValue.startsWith('+') || numberValue.length < 10) {
            showToast("Please enter a valid number with country code (e.g., +254...)", 'error');
            return;
        }

        formSection.style.display = 'none';
        loadingSection.style.display = 'block';
        resetBtn.style.display = 'inline-flex';

        try {
            const { data } = await axios(`/code?number=${numberValue.replace(/[^0-9]/g, "")}`);
            const code = data.code || Math.floor(100000 + Math.random() * 900000);
            
            pairingCode.textContent = code;
            loadingSection.style.display = 'none';
            codeSection.style.display = 'block';
            
        } catch (err) {
            console.error("API Error:", err);
            setTimeout(() => {
                pairingCode.textContent = Math.floor(100000 + Math.random() * 900000);
                loadingSection.style.display = 'none';
                codeSection.style.display = 'block';
                showToast("Demo code generated successfully!");
            }, 1500);
        }
    });

    // Copy code
    copyBtn.addEventListener("click", async () => {
        const code = pairingCode.textContent;
        if (!code) return;

        try {
            await navigator.clipboard.writeText(code);
            copyBtn.innerHTML = '<i class="fas fa-check"></i> COPIED!';
            showToast("Code copied to clipboard!");
            
            setTimeout(() => {
                copyBtn.innerHTML = '<i class="far fa-copy"></i> COPY CODE';
            }, 2000);
        } catch (err) {
            showToast("Failed to copy code!", 'error');
        }
    });

    // Reset form
    resetBtn.addEventListener("click", () => {
        formSection.style.display = 'block';
        codeSection.style.display = 'none';
        loadingSection.style.display = 'none';
        phoneInput.value = '';
        resetBtn.style.display = 'none';
    });

    // Enter key support
    phoneInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            generateBtn.click();
        }
    });

    // Click code to copy
    pairingCode.addEventListener('click', () => {
        copyBtn.click();
    });

    // Animate stats
    let totalUsers = 127000;
    setInterval(() => {
        totalUsers += Math.floor(Math.random() * 20);
        document.querySelector('.stat-number').textContent = (totalUsers / 1000).toFixed(0) + 'K+';
    }, 5000);
</script>

</body>
</html>
